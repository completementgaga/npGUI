
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>np_gui.np_clickable_image &#8212; npGUI 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for np_gui.np_clickable_image</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">--------------------------------</span>
<span class="sd">The np_clickable_image module</span>
<span class="sd">--------------------------------</span>

<span class="sd">    This module implements ClickableImage and some subclasses.</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">skimage</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">inspect</span><span class="o">,</span> <span class="nn">warnings</span>


<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">image_annotation</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">colors</span>


<div class="viewcode-block" id="_CombinableFunc"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image._CombinableFunc">[docs]</a><span class="k">class</span> <span class="nc">_CombinableFunc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class of callables mimicking positional keywords functions.</span>

<span class="sd">    A class of callables mimicking functions with only positional</span>
<span class="sd">    keyword arguments with better control on signature and default</span>
<span class="sd">    values. This class does not care about the specific order of the</span>
<span class="sd">    positional keyword arguments.</span>


<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="_CombinableFunc.defaults_dictionary"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image._CombinableFunc.defaults_dictionary">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">defaults_dictionary</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the keyword(-only) arguments default values.</span>

<span class="sd">        Args:</span>
<span class="sd">            f (Callable[Any,Any]): A function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary with keys given by the keyword arguments</span>
<span class="sd">                and keyword-only arguments of f that maps these keys to</span>
<span class="sd">                the corresponding default values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">args</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">defaults</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">-</span> <span class="n">n</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;There are some positional non-keyword &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;arguments in your function&quot;</span>
            <span class="p">)</span>
        <span class="n">args_dic</span> <span class="o">=</span> <span class="p">{</span><span class="n">args</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]:</span> <span class="n">defaults</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)}</span>
        <span class="n">kwonlydefaults</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">kwonlydefaults</span>
        <span class="k">if</span> <span class="n">kwonlydefaults</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwonlydefaults</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">args_dic</span> <span class="o">|</span> <span class="n">kwonlydefaults</span></div>

<div class="viewcode-block" id="_CombinableFunc.__init__"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image._CombinableFunc.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">defaults_dic</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the callable.</span>

<span class="sd">            Build the callable from a  keyword(-only) function and</span>
<span class="sd">            optionally a dictionary. The function can be defined with</span>
<span class="sd">            a signature ( \*\*kwargs, \*, ...). In this case, the placeholder</span>
<span class="sd">            for a detailed specification of keyword</span>
<span class="sd">            arguments is the dictionary, see below. If the dictionary</span>
<span class="sd">            is not passed, the function&#39;s signature must specify every</span>
<span class="sd">            admissible positional keyword argument. Functions using</span>
<span class="sd">            also keyword-only arguments can be passed but the</span>
<span class="sd">            keyword-only arguments with no default value will be</span>
<span class="sd">            ignored. If a dictionary is passed, the function&#39;s signature</span>
<span class="sd">            is ignored.</span>


<span class="sd">        Args:</span>
<span class="sd">            func (Callable): A function with solely keyword and</span>
<span class="sd">                keyword-only arguments;</span>
<span class="sd">            dic (dict, optional): A dictionary specifying all admissible</span>
<span class="sd">                positional keyword arguments TOGETHER WITH their</span>
<span class="sd">                default values. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">defaults_dic</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">defaults_dic</span> <span class="o">=</span> <span class="n">_CombinableFunc</span><span class="o">.</span><span class="n">defaults_dictionary</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">defaults_dic</span> <span class="o">=</span> <span class="n">defaults_dic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">func</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults_dic</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="s2">&quot;The argument &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; is not valid for this callable.&quot;</span>
                <span class="p">)</span>
        <span class="n">completed_args</span> <span class="o">=</span> <span class="n">kwargs</span> <span class="o">|</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults_dic</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults_dic</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">**</span><span class="n">completed_args</span><span class="p">)</span></div>


<span class="c1"># # Testing _CombinableFunc</span>
<span class="c1"># def _f(a=2, *, u=3):</span>
<span class="c1">#     return a + u</span>


<span class="c1"># f = _CombinableFunc(_f)</span>
<span class="c1"># print(f())  # 5</span>
<span class="c1"># print(f(a=7))  # 10</span>
<span class="c1"># print(f(a=7, u=12))  # 19</span>
<span class="c1"># print(f(u=13))  # 15</span>


<span class="c1"># def _g(**kwargs):</span>
<span class="c1">#     return sum([*kwargs.values()])</span>


<span class="c1"># defaults = {&quot;a&quot;: 2, &quot;u&quot;: 3}</span>
<span class="c1"># g = _CombinableFunc(_g, defaults)</span>
<span class="c1"># print(g())  # 5</span>
<span class="c1"># print(g(a=7))  # 10</span>
<span class="c1"># print(g(a=7, u=12))  # 19</span>
<span class="c1"># print(g(u=13))  # 15</span>


<span class="c1"># A decorator to define _CombinableFuncs as functions with detailed</span>
<span class="c1"># signatures.</span>
<span class="k">def</span> <span class="nf">_combinable_func</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_CombinableFunc</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>


<span class="c1"># @_combinable_func</span>
<span class="c1"># def f(a=2, *, u=3):</span>
<span class="c1">#     return a + u</span>


<span class="c1"># print(f())  # 5</span>
<span class="c1"># print(f(a=7))  # 10</span>
<span class="c1"># print(f(a=7, u=12))  # 19</span>
<span class="c1"># print(f(u=13))  # 15</span>
<span class="c1"># print(f.defaults_dic)</span>


<div class="viewcode-block" id="ClickableImage"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.ClickableImage">[docs]</a><span class="k">class</span> <span class="nc">ClickableImage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class for clickable images, made with matplotlib and numpy.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ClickableImage.__init__"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.ClickableImage.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">shape</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
        <span class="n">regions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">callbacks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]],</span>
        <span class="n">vars_dic</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Builder method</span>

<span class="sd">        Args:</span>
<span class="sd">            image (Callable[Any, np.ndarray] | np.ndarray): A function that</span>
<span class="sd">                returns an image or a &#39;constant&#39; image. If a function is</span>
<span class="sd">                passed, it must have only keyword and keyword-only arguments.</span>
<span class="sd">                The keyword-only arguments with no default value will be</span>
<span class="sd">                ignored.</span>

<span class="sd">            shape (tuple[int, ...]): shape of the ndarray returned by</span>
<span class="sd">                image</span>
<span class="sd">            regions (list[np.ndarray]): boolean arrays A with A.shape=shape[:2]</span>

<span class="sd">            callbacks (list[Callable[dict, None]]): functions to be</span>
<span class="sd">                called when the regions are clicked</span>
<span class="sd">                (the ith callback belongs to the ith region)</span>
<span class="sd">            vars_dic (dict): some variable values stored in a dict. They</span>
<span class="sd">                are meant to define the behaviour of the image attributes</span>
<span class="sd">                of the current instance and possibly other ones, in view of</span>
<span class="sd">                interactions between instances (stacking).</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: The number of regions does not equal the</span>
<span class="sd">                number of callbacks.</span>
<span class="sd">            ValueError: The regions&#39; shapes do not all equal shape[:2]</span>
<span class="sd">            ValueError: The passed regions do not have</span>
<span class="sd">                dtype(&#39;bool&#39;) dtype.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Compatibility checks.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">callbacks</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The number of regions does not equal the&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; number of callbacks&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">region</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The regions&#39; shapes do not all equal shape[:2]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">region</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The passed regions do not have dtype(&#39;bool&#39;) dtype.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">_CombinableFunc</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">_CombinableFunc</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">_CombinableFunc</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="n">regions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars_dic</span> <span class="o">=</span> <span class="n">vars_dic</span></div>

    <span class="k">def</span> <span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dic</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dic</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_dic</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">defaults_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">}</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The image attribute of your ClickableImage &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;did not return a ndarray with shape equal to the shape &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;attribute.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">click_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars_dic</span><span class="p">)</span>

<div class="viewcode-block" id="ClickableImage.use"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.ClickableImage.use">[docs]</a>    <span class="k">def</span> <span class="nf">use</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">return_vars</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_options</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use the clickable image to get some user input.</span>

<span class="sd">        For this method to work, all the keyword arguments for image</span>
<span class="sd">        must be contained in vars_dic.</span>

<span class="sd">        Args:</span>
<span class="sd">            return_vars (list[str] | None, optional):</span>
<span class="sd">                The keys of vars_dic we are interested in. Defaults to None.</span>
<span class="sd">                If None is received, all vars_dic will be returned after</span>
<span class="sd">                the interaction.</span>

<span class="sd">            **plot_options: the optional arguments to be passed to</span>
<span class="sd">                imshow. Useful to affect the display.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The requested dictionary of variables values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Display initialization.</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(),</span> <span class="o">**</span><span class="n">plot_options</span><span class="p">)</span>

        <span class="c1"># Event handling.</span>
        <span class="k">def</span> <span class="nf">onclick</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>

                <span class="c1"># Variables and display update.</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">region</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">click_action</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(),</span> <span class="o">**</span><span class="n">plot_options</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.0001</span><span class="p">)</span>

        <span class="n">cid</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s2">&quot;button_press_event&quot;</span><span class="p">,</span> <span class="n">onclick</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">return_vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_dic</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_dic</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">return_vars</span><span class="p">}</span></div>

    <span class="k">def</span> <span class="nf">has_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clickable</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ClickableImage</span><span class="p">]):</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_dic</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">defaults_dic</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">clickable</span><span class="o">.</span><span class="n">vars_dic</span> <span class="o">|</span> <span class="n">clickable</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">defaults_dic</span>
        <span class="n">keys1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">keys2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">d2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">keys1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">keys2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">new_image_func</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">to_be_transposed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ndim</span> <span class="o">=</span> <span class="n">to_be_transposed</span><span class="o">.</span><span class="n">ndim</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
                <span class="n">to_be_transposed</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ndim</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="n">new_image</span> <span class="o">=</span> <span class="n">_CombinableFunc</span><span class="p">(</span><span class="n">new_image_func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">defaults_dic</span><span class="p">)</span>
        <span class="n">new_regions</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">region</span><span class="p">)</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">]</span>
        <span class="n">new_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

        <span class="k">return</span> <span class="n">ClickableImage</span><span class="p">(</span>
            <span class="n">new_image</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">,</span> <span class="n">new_regions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_dic</span>
        <span class="p">)</span>

<div class="viewcode-block" id="ClickableImage.constant_to_clickable"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.ClickableImage.constant_to_clickable">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">constant_to_clickable</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClickableImage</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert np.ndarray image to ClickableImage.</span>

<span class="sd">        Args:</span>
<span class="sd">            img (np.ndarray): an image</span>

<span class="sd">        Returns:</span>
<span class="sd">            ClickableImage: The corresponding &quot;constant&quot; ClickableImage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ClickableImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">{})</span></div>

<div class="viewcode-block" id="ClickableImage.hstack"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.ClickableImage.hstack">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">hstack</span><span class="p">(</span>
        <span class="n">clickables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ClickableImage</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClickableImage</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stack horizontally the input ClickableImages or np.ndarray images.</span>

<span class="sd">        Args:</span>
<span class="sd">            clickables (list[ClickableImage|np.ndarray]): list of</span>
<span class="sd">                ClickableImages or images, in the second case they are</span>
<span class="sd">                treated as &#39;constant&#39; ClickableImages.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: The clickables are not stackable as demanded, due</span>
<span class="sd">                to shape issues.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ClickableImage: The ClickableImage obtained by stacking</span>
<span class="sd">                horizontally the input clickables/images, with possible</span>
<span class="sd">                interactions if they share keys of their</span>
<span class="sd">                image.defaults_dic | vars_dic</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">clickables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clickables</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clickables</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">clickables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ClickableImage</span><span class="o">.</span><span class="n">constant_to_clickable</span><span class="p">(</span>
                    <span class="n">clickables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="k">def</span> <span class="nf">measure_depth</span><span class="p">(</span><span class="n">clickable</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">clickable</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">depth</span> <span class="o">=</span> <span class="n">measure_depth</span><span class="p">(</span><span class="n">clickables</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">same_heights</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span><span class="n">clickable</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">height</span> <span class="k">for</span> <span class="n">clickable</span> <span class="ow">in</span> <span class="n">clickables</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">same_depth</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span><span class="n">measure_depth</span><span class="p">(</span><span class="n">clickable</span><span class="p">)</span> <span class="o">==</span> <span class="n">depth</span> <span class="k">for</span> <span class="n">clickable</span> <span class="ow">in</span> <span class="n">clickables</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">same_heights</span> <span class="ow">and</span> <span class="n">same_depth</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The clickables are not stackable as demanded,&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; due to shape issues.&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; Remember this could include a depth issue.&quot;</span>
            <span class="p">)</span>
        <span class="n">n_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clickables</span><span class="p">)</span>
        <span class="n">block_x_coords</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">sum</span><span class="p">(</span><span class="n">clickables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_blocks</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">block_x_coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>

        <span class="n">new_regions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_callbacks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_vars_dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">new_image_defaults</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">clickable</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clickables</span><span class="p">):</span>
            <span class="n">new_callbacks</span> <span class="o">+=</span> <span class="n">clickable</span><span class="o">.</span><span class="n">callbacks</span>
            <span class="n">new_vars_dic</span> <span class="o">|=</span> <span class="n">clickable</span><span class="o">.</span><span class="n">vars_dic</span>
            <span class="n">new_image_defaults</span> <span class="o">|=</span> <span class="n">clickable</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">defaults_dic</span>

            <span class="c1"># Checking for interactions between the blocks.</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">other_clickable</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clickables</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">other_clickable</span><span class="o">.</span><span class="n">has_interaction</span><span class="p">(</span><span class="n">clickable</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;It is likely that you are setting up some &quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;interactions between the &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;th and &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;th passed clickables (counting from 0): &quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;they have common keys in their respective &quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;&#39;vars_dics | image.defaults_dic&#39;.&quot;</span>
                    <span class="p">)</span>

            <span class="c1"># Regions processing.</span>
            <span class="n">empty_left_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">block_x_coords</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;bool&quot;</span>
            <span class="p">)</span>
            <span class="n">empty_right_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">-</span> <span class="n">block_x_coords</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;bool&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">clickable</span><span class="o">.</span><span class="n">regions</span><span class="p">:</span>
                <span class="n">translated_region</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">empty_left_block</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">empty_right_block</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">new_regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">translated_region</span><span class="p">)</span>

        <span class="c1"># new_image callable definition</span>

        <span class="k">def</span> <span class="nf">new_image_func</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">clickable</span> <span class="ow">in</span> <span class="n">clickables</span><span class="p">:</span>
                <span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">clickable</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">clickable</span> <span class="ow">in</span> <span class="n">clickables</span>
                <span class="p">]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">blocks</span><span class="p">)</span>

        <span class="c1"># new_image definition</span>
        <span class="n">new_image</span> <span class="o">=</span> <span class="n">_CombinableFunc</span><span class="p">(</span><span class="n">new_image_func</span><span class="p">,</span> <span class="n">new_image_defaults</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ClickableImage</span><span class="p">(</span>
            <span class="n">new_image</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">,</span> <span class="n">new_regions</span><span class="p">,</span> <span class="n">new_callbacks</span><span class="p">,</span> <span class="n">new_vars_dic</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ClickableImage.vstack"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.ClickableImage.vstack">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">vstack</span><span class="p">(</span>
        <span class="n">clickables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ClickableImage</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">()],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClickableImage</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stack vertically the input ClickableImages or np.ndarray images.</span>

<span class="sd">        Args:</span>
<span class="sd">            clickables (list[ClickableImage|np.ndarray]): list of</span>
<span class="sd">                ClickableImages or images, in the second case they are treated</span>
<span class="sd">                as&#39;constant&#39; ClickableImages.</span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: The clickables are not stackable as demanded,</span>
<span class="sd">                due to shape issues. Remember this could include a depth issue.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ClickableImage: The ClickableImage obtained by stacking</span>
<span class="sd">                vertically the input clickables, with possible</span>
<span class="sd">                interactions if they share keys of their</span>
<span class="sd">                image.defaults_dic | vars_dic</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clickables</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clickables</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">clickables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ClickableImage</span><span class="o">.</span><span class="n">constant_to_clickable</span><span class="p">(</span>
                    <span class="n">clickables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="n">new_clickables</span> <span class="o">=</span> <span class="p">[</span><span class="n">clickable</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="k">for</span> <span class="n">clickable</span> <span class="ow">in</span> <span class="n">clickables</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ClickableImage</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">new_clickables</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span></div>

<div class="viewcode-block" id="ClickableImage.resize"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.ClickableImage.resize">[docs]</a>    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">shape</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">anti_aliasing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">preserve_range</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClickableImage</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resize self to input shape.</span>

<span class="sd">        Args:</span>
<span class="sd">            shape (tuple[int,int]): Desired 2d shape for the output.</span>
<span class="sd">            anti_aliasing (bool, optional): argument to be passed in</span>
<span class="sd">                the underlying skimage.resize call. Defaults to False.</span>
<span class="sd">            preserve_range (bool, optional): argument to be passed in</span>
<span class="sd">                the underlying skimage.resize call. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ClickableImage: The resized version of self, with the same </span>
<span class="sd">                number of channels as self.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">new_image_func</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
                <span class="n">shape</span><span class="p">,</span>
                <span class="n">anti_aliasing</span><span class="o">=</span><span class="n">anti_aliasing</span><span class="p">,</span>
                <span class="n">preserve_range</span><span class="o">=</span><span class="n">preserve_range</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">new_image</span> <span class="o">=</span> <span class="n">_CombinableFunc</span><span class="p">(</span><span class="n">new_image_func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">defaults_dic</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">new_shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_shape</span><span class="o">=</span><span class="n">shape</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">new_regions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">ClickableImage</span><span class="p">(</span>
            <span class="n">new_image</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">,</span> <span class="n">new_regions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_dic</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ClickableImage.center_in_shape"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.ClickableImage.center_in_shape">[docs]</a>    <span class="k">def</span> <span class="nf">center_in_shape</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">frame_color</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClickableImage</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return clickable of the given shape with self in the center.</span>

<span class="sd">        Args:</span>
<span class="sd">            shape (tuple[int, int]): the 2d shape in which self should be</span>
<span class="sd">                centered</span>

<span class="sd">            frame_color (_type_, optional): The color of the added pixels.</span>
<span class="sd">            Defaults to None. If None is passed, the main color of</span>
<span class="sd">                self.get_image() will be used. Otherwise, this argument</span>
<span class="sd">                must be parsable by np_gui.colors.color_to_rgb.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ClickableImage: A new clickable A with A.shape=shape,</span>
<span class="sd">                self in the center and extra pixels color specified by</span>
<span class="sd">                frame_color.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">frame_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frame_color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">main_color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frame_color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">color_to_rgb</span><span class="p">(</span><span class="n">frame_color</span><span class="p">)</span>
        <span class="n">y_factor</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x_factor</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y_factor</span><span class="p">,</span> <span class="n">x_factor</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">factor</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The passed shape is not bigger than self.shape, &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;we will use a resized copy of self to fit the shape.&quot;</span>
            <span class="p">)</span>
            <span class="n">factor</span> <span class="o">-=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">new_shape</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span><span class="p">),</span>
                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">resized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">resized</span><span class="o">.</span><span class="n">center_in_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">frame_color</span><span class="o">=</span><span class="n">frame_color</span><span class="p">)</span>
        <span class="n">top_block_shape</span> <span class="o">=</span> <span class="p">((</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">bottom_block_shape</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">top_block_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">right_block_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">left_block_shape</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">right_block_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">block_shape</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">mono_block</span><span class="p">(</span>
                    <span class="n">block_shape</span><span class="p">,</span> <span class="n">frame_color</span>
                <span class="p">),</span>
                <span class="p">[</span>
                    <span class="n">top_block_shape</span><span class="p">,</span>
                    <span class="n">bottom_block_shape</span><span class="p">,</span>
                    <span class="n">left_block_shape</span><span class="p">,</span>
                    <span class="n">right_block_shape</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ClickableImage</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">top</span><span class="p">,</span> <span class="n">ClickableImage</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">right</span><span class="p">]),</span> <span class="n">bottom</span><span class="p">]</span>
        <span class="p">)</span></div></div>


<span class="c1"># Tests for the ClickableImage class.</span>
<span class="c1"># A = np.array([[1, 1], [0, 0]], dtype=&quot;bool&quot;)</span>
<span class="c1"># def image(is_on=True):</span>
<span class="c1">#     return is_on &amp; A</span>
<span class="c1"># def toggle(dic):</span>
<span class="c1">#     dic[&quot;is_on&quot;] ^= True</span>


<span class="c1"># u = ClickableImage(image, (2, 2), [A], [toggle], {&quot;is_on&quot;: True})</span>

<span class="c1"># print(u.get_image())</span>
<span class="c1"># u.click_action(0)</span>
<span class="c1"># print(u.get_image())</span>
<span class="c1"># u.click_action(0)</span>
<span class="c1"># print(u.get_image())</span>


<span class="c1"># v = ClickableImage.hstack([u, u])</span>
<span class="c1"># print(v.callbacks)</span>
<span class="c1"># print(v.regions)</span>
<span class="c1"># print(v.vars_dic)</span>
<span class="c1"># v.click_action(1)</span>
<span class="c1"># print(v.vars_dic)</span>

<span class="c1"># print(v.use())</span>
<span class="c1"># print(u.transpose().use())</span>
<span class="c1"># print(ClickableImage.vstack([u, u]).use(cmap=&quot;gray&quot;))</span>


<div class="viewcode-block" id="ImageToggles"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.ImageToggles">[docs]</a><span class="k">class</span> <span class="nc">ImageToggles</span><span class="p">(</span><span class="n">ClickableImage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A subclass of ClickableImage where regions of the image become toggles.</span>

<span class="sd">    No new method, a unique original method: __init__ which &#39;extends&#39; the</span>
<span class="sd">    superclass&#39;s method.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ImageToggles.__init__"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.ImageToggles.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">regions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">daltonism</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">on_color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
        <span class="n">off_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
        <span class="n">default_toggle_value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">true_is_black_pixel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">toggles_name</span><span class="o">=</span><span class="s2">&quot;toggles&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build self. Extend super().__init__, with distinct arguments.</span>

<span class="sd">        Args:</span>
<span class="sd">            image (np.ndarray): The &quot;background&quot; image</span>
<span class="sd">            regions (list[np.ndarray]): the &#39;toggle&#39; regions as boolean images.</span>
<span class="sd">            daltonism (bool, optional): Option to set a special color mode for</span>
<span class="sd">                color blind people. Defaults to False.</span>
<span class="sd">            on_color (str, optional): The color of the regions when toggled to</span>
<span class="sd">                True. Defaults to &quot;green&quot;. This string must be recognized</span>
<span class="sd">                by matplotlib.colors.to_rgb.</span>
<span class="sd">            off_color (str, optional): The color of the regions when toggled to</span>
<span class="sd">                False. Defaults to &quot;red&quot;.  This string must be recognized</span>
<span class="sd">                by matplotlib.colors.to_rgb.</span>
<span class="sd">            default_toggle_value (bool, optional): The common value of all</span>
<span class="sd">            toggles as defined in the Clickable image vars_dic. Defaults to True.</span>
<span class="sd">            true_is_black_pixel (bool, optional): Decide if the front pixel</span>
<span class="sd">                are black, in case image is boolean. Defaults to True.</span>
<span class="sd">            toggles_name (str, optional): the key of the toggles values list in</span>
<span class="sd">                the ClickableImage&#39;s vars_dic. Defaults to &quot;toggles&quot;.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: &quot;The input regions do not have &#39;bool&#39; dtype.&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="n">regions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The input regions do not have &#39;bool&#39; dtype.&quot;</span><span class="p">)</span>

        <span class="c1"># Defining a clickable image, we first calculate the &#39;image&#39; attribute.</span>
        <span class="k">if</span> <span class="n">daltonism</span><span class="p">:</span>
            <span class="n">on_color</span> <span class="o">=</span> <span class="s2">&quot;cyan&quot;</span>
            <span class="n">off_color</span> <span class="o">=</span> <span class="s2">&quot;magenta&quot;</span>
        <span class="n">on_color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">color_to_rgb</span><span class="p">(</span><span class="n">on_color</span><span class="p">)</span>
        <span class="n">off_color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">color_to_rgb</span><span class="p">(</span><span class="n">off_color</span><span class="p">)</span>

        <span class="n">my_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">off_color</span><span class="p">,</span> <span class="n">on_color</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">_displayed_image</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">toggles</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">toggles_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">true_is_black_pixel</span> <span class="ow">and</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">image</span> <span class="o">^</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">):</span>
                <span class="n">output</span><span class="p">[</span><span class="n">region</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_colors</span><span class="p">[</span><span class="n">toggles</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">return</span> <span class="n">output</span>

        <span class="n">vars_dic</span> <span class="o">=</span> <span class="p">{</span><span class="n">toggles_name</span><span class="p">:</span> <span class="p">[</span><span class="n">default_toggle_value</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">)}</span>
        <span class="n">displayed_image</span> <span class="o">=</span> <span class="n">_CombinableFunc</span><span class="p">(</span><span class="n">_displayed_image</span><span class="p">,</span> <span class="n">vars_dic</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">toggle_family</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">dic</span><span class="p">):</span>
                <span class="n">dic</span><span class="p">[</span><span class="n">toggles_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">dic</span><span class="p">[</span><span class="n">toggles_name</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span>
                    <span class="k">else</span> <span class="n">dic</span><span class="p">[</span><span class="n">toggles_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="kc">True</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="n">toggles_name</span><span class="p">]))</span>
                <span class="p">]</span>

            <span class="k">return</span> <span class="n">f</span>

        <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[</span><span class="n">toggle_family</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">))]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">displayed_image</span><span class="p">,</span>
            <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,),</span>
            <span class="n">regions</span><span class="p">,</span>
            <span class="n">callbacks</span><span class="p">,</span>
            <span class="n">vars_dic</span><span class="p">,</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="RadioButton"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.RadioButton">[docs]</a><span class="k">class</span> <span class="nc">RadioButton</span><span class="p">(</span><span class="n">ImageToggles</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A subclass for radio buttons.</span>

<span class="sd">    It has a unique original method: the _init_ method extends the</span>
<span class="sd">    superclass&#39; one.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RadioButton.__init__"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.RadioButton.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">toggle_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;radio_toggle&quot;</span><span class="p">,</span>
        <span class="n">checked</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instantiate RadioButton.</span>

<span class="sd">        Args:</span>
<span class="sd">            radius (int): radius of the external circle of the button.</span>
<span class="sd">            toggle_name (str, optional): vars_dic keyword for the button</span>
<span class="sd">                status (checked or not). Defaults to &quot;radio_toggle&quot;.</span>
<span class="sd">            checked (bool, optional): Initial state of the button.</span>
<span class="sd">                Defaults to False. If False, the button starts unchecked.</span>
<span class="sd">                Otherwise, it starts checked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">external_circle</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
        <span class="p">)</span>
        <span class="n">internal_dot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">external_circle</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;bool&quot;</span><span class="p">)</span>

        <span class="n">external_circle</span><span class="p">[</span>
            <span class="n">skimage</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">circle_perimeter</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
        <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">internal_dot</span><span class="p">[</span>
            <span class="n">skimage</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">disk</span><span class="p">((</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span> <span class="o">//</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">external_circle</span><span class="p">,</span>
            <span class="p">[</span><span class="n">internal_dot</span><span class="p">],</span>
            <span class="n">on_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">off_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
            <span class="n">toggles_name</span><span class="o">=</span><span class="n">toggle_name</span><span class="p">,</span>
            <span class="n">default_toggle_value</span><span class="o">=</span><span class="n">checked</span><span class="p">,</span>
        <span class="p">)</span></div></div>



<div class="viewcode-block" id="SliceDisplayer"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.SliceDisplayer">[docs]</a><span class="k">class</span> <span class="nc">SliceDisplayer</span><span class="p">(</span><span class="n">ClickableImage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This subclass is for clickable images that display a slice of text.</span>

<span class="sd">    The slice may have variable start and stop.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SliceDisplayer.__init__"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.SliceDisplayer.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">shape</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">background_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="n">slice_varname</span><span class="o">=</span><span class="s2">&quot;slice&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extends __init__ of superclass, with distinct arguments.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): The text whose slice will be displayed</span>
<span class="sd">            shape (tuple[int, int]): The shape of the resulting ClickableImage</span>
<span class="sd">            background_color (str, optional): Background color, this string</span>
<span class="sd">                must be recognized by matplotlib.colors.to_rgb.</span>
<span class="sd">                Defaults to &quot;white&quot;.</span>
<span class="sd">            slice_varname (str, optional): The name of the variable that</span>
<span class="sd">                defines the slice to take. Defaults to &quot;slice&quot;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults_dic</span> <span class="o">=</span> <span class="p">{</span><span class="n">slice_varname</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">7</span><span class="p">)}</span>

        <span class="k">def</span> <span class="nf">text_image_</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">image_annotation</span><span class="o">.</span><span class="n">center_text</span><span class="p">(</span>
                <span class="n">text</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="n">slice_varname</span><span class="p">]],</span>
                <span class="n">shape</span><span class="p">,</span>
                <span class="n">background_color</span><span class="o">=</span><span class="n">background_color</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">text_image</span> <span class="o">=</span> <span class="n">_CombinableFunc</span><span class="p">(</span><span class="n">text_image_</span><span class="p">,</span> <span class="n">defaults_dic</span><span class="p">)</span>
        <span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">text_image</span><span class="p">,</span> <span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">regions</span><span class="p">,</span> <span class="n">callbacks</span><span class="p">,</span> <span class="n">defaults_dic</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="Button"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.Button">[docs]</a><span class="k">class</span> <span class="nc">Button</span><span class="p">(</span><span class="n">ClickableImage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The subclass of ClickableImage made of basic rectangular buttons.</span>

<span class="sd">    More precisely, the unique clickable region is the whole image.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Button.__init__"><a class="viewcode-back" href="../../index.html#np_gui.np_clickable_image.Button.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Button constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            image (np.ndarray): The underlying image of the button.</span>
<span class="sd">            callback (Callable): The callback triggered by clicking the button.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">image</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">image</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">image</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">image</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The image argument is expected to be a &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;binary, grayscale or rgb image.&quot;</span>
            <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;bool&quot;</span><span class="p">)],</span>
            <span class="p">[</span><span class="n">callback</span><span class="p">],</span>
            <span class="n">vars_dic</span><span class="o">=</span><span class="p">{},</span>
        <span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Gaël Cousin.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>